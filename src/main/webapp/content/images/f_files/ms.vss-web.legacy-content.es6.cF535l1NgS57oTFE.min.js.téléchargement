"use strict";define("VSS/Legacy",["require","exports","react","VSS/Platform/Layout","VSS/Platform/Context"],function(e,t,n,a,o){var s,i;!function(e){s=t.ComponentsLegacyLegacy={},Object.defineProperty(t,"__esModule",{value:!0});class o extends a.VssComponent{constructor(){super(...arguments),this.onDependenciesResolved=(()=>{return this.context.pageContext.getService("ILegacyPlatformService").loadModules(this.props.modules,this.props.dependentContributionIds)})}render(){const e=Object.assign({},this.props,{modules:void 0,dependentContributionIds:void 0,onDependenciesResolved:this.onDependenciesResolved});return this.props.componentType&&(e.wrappedType=this.props.componentType),n.createElement(a.WrappedComponent,e,this.props.children)}}t.ComponentsLegacyLegacy.LegacyComponent=o,a.Components.add("legacy",o)}(),function(e){i=t.LegacyPlatformService={},Object.defineProperty(t,"__esModule",{value:!0});const n="ms.vss-web.legacy-platform-data-provider",a=[n,"ms.vss-web.legacy-vss-ui-content"],s=window;let c;o.Services.add("ILegacyPlatformService",{serviceFactory:class extends o.VssService{_serviceStart(e){super._serviceStart(e);const t=this.pageContext.getService("IVssContributionService").getData(n);t&&t.preloadContent&&this._ensureLegacyContentLoaded(()=>{})}loadModules(e,t){return new Promise((n,a)=>{const o=()=>{e&&e.length?s.requirejs("VSS/VSS").requireModules(e).then(()=>{n()}):n()};this._ensureLegacyContentLoaded(()=>{t&&t.length?s.requirejs(["VSS/Service","VSS/Contributions/Services"],(e,n)=>{e.getService(n.ExtensionService).getContributions(t,!0,!0,!0).then(()=>{o()})}):o()})})}getLegacyPageContext(e){return this.loadModules().then(()=>{let t=s.__vssPageContext;return e&&!t.webContext.team?this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-tfs-web.team-context-data-provider").then(e=>(e&&(t=Object.assign({},t,{webContext:Object.assign({},t.webContext,{team:Object.assign({},e)})})),t)):s.__vssPageContext})}requireModules(e){return this.loadModules(e).then(()=>e.map(e=>s.requirejs(e)))}_ensureLegacyContentLoaded(e){if(this._legacyContentLoaded||s.__legacyContentLoaded)e();else if(this._legacyContentLoadedCallbacks)this._legacyContentLoadedCallbacks.push(e);else{this._legacyContentLoadedCallbacks=[e],this.pageContext.getService("IVssPerformanceService").addSplitTiming("LegacyPlatformService.LoadStarted");const t=this.pageContext.getService("IVssContributionService"),o=t.getData(n);o?this._processLegacyData(o):t.getContributionsAsync(a).then(()=>{const e=t.getData(n);if(e){const n=t.getData("ms.vss-tfs-web.page-data");n&&(n.project&&(e.pageContext.webContext.project={id:n.project.id,name:n.project.name}),n.team&&(e.pageContext.webContext.team={id:n.team.id,name:n.team.name})),this._processLegacyData(e)}})}}_processLegacyData(e){this.pageContext.getService("IVssContentService").loadScripts(e.content).then(()=>{this.pageContext.getService("IVssPerformanceService").addSplitTiming("LegacyPlatformService.ContentLoaded"),this._processLegacyDataWithDOM(e)})}_processLegacyDataWithDOM(e){const t=document.createElement("div");t.classList.add("legacy-data"),t.style.display="none",document.body.appendChild(t),this._createLegacyJsonIsland(t,"feature-licenses",e.featureLicenseInfo),this._createLegacyJsonIsland(t,"vss-contribution-data",e.contributionsPageData),this._createLegacyJsonIsland(t,"vss-bundle-data",e.content.filter(e=>!!e.bundle)),s._builtinPlugins=e.builtInPlugins,s._builtInBases=e.builtInPluginBases,s.__vssPageContext=e.pageContext,s.__cultureInfo=s.__vssPageContext.microsoftAjaxConfig.cultureInfo,s.requirejs.config(s.__vssPageContext.moduleLoaderConfig),s.requirejs.config({map:{"*":{React:"react"}}});const a=this.pageContext.getService("IVssNavigationService").getCurrentRoute();s.__vssPageContext.navigation.routeId=a.routeId,s.__vssPageContext.navigation.routeTemplates=a.routeTemplates,c=this.pageContext,document.body.addEventListener("fpsLoading",()=>{s.__legacyFpsLoading=!0}),document.body.addEventListener("fpsCompleted",e=>{if(e.detail.success){const e=this.pageContext.getService("IVssContributionService").getData(n);if(s.__legacyFpsLoading=!1,s.__updatedLegacyData=e,c=this.pageContext,e){const t=s.__vssPageContext;t.webContext.project=e.pageContext.webContext.project,t.webContext.team=e.pageContext.webContext.team,t.diagnostics.activityId=e.pageContext.diagnostics.activityId,document.body.dispatchEvent(new CustomEvent("legacyFpsComplete",{detail:e}))}}}),window.performance&&window.performance.mark&&window.performance.mark("requireStart"),s.requirejs(e.scriptsToRequire,()=>{if(window.performance&&window.performance.mark&&window.performance.mark("requireEnd"),s.requiredModulesLoaded=!0,s.requirejs(["VSS/Events/Page"],e=>{e.getService().fire(e.CommonPageEvents.InitialScriptsLoaded)}),this._legacyContentLoaded=!0,this._legacyContentLoadedCallbacks){for(const e of this._legacyContentLoadedCallbacks)e();delete this._legacyContentLoadedCallbacks}})}_createLegacyJsonIsland(e,t,n){const a=document.createElement("script");a.type="application/json",a.classList.add(t),a.innerText=JSON.stringify(n),e.appendChild(a)}},options:6}),t.LegacyPlatformService.getLWPService=function(e){if(c)return c.getService(e)}}(),t.Legacy={},Object.defineProperty(t,"__esModule",{value:!0}),t.Legacy.LegacyComponent=s.LegacyComponent,t.Legacy.getLWPService=i.getLWPService},["Components/Legacy/Legacy","LegacyPlatformService","Legacy"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-web.legacy-content"}}));