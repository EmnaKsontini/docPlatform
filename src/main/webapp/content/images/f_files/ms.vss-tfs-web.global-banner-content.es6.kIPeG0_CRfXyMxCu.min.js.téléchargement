"use strict";define("TFS/GlobalBanner",["require","exports","VSS/Platform/Context","VSS/Platform/Fetch","react","VSS/Platform/Components/Format","VSS/Platform/Layout","VSSUI/Link","VSS/Features/PlatformUI/FPSLink","VSSUI/Icon","VSSUI/TooltipEx"],function(e,s,t,n,a,o,i,r,l,c,g){var m,d,h,p,u;m=s.Resources={},Object.defineProperty(s,"__esModule",{value:!0}),s.Resources.Dismiss="Dismiss",s.Resources.LearnMore="Learn more",function(e){d=s[e]={},Object.defineProperty(s,"__esModule",{value:!0}),s[e].GlobalMessageChangedEvent="MESSAGE_CHANGED",s[e].GlobalDialogChangedEvent="DIALOG_CHANGED",s[e].GlobalToastChangedEvent="TOAST_CHANGED";const a="globalDialogData",o="GlobalDialog/Dismissed/",i="globalMessageData",r="GlobalMessage/Dismissed/";t.Services.add("IGlobalMessagesService",{serviceFactory:class extends t.VssObservableService{constructor(){super(...arguments),this.handleEndRequest=(e=>{if(e.response&&e.response.headers){const s=e.response.headers.get("X-VSS-GlobalMessage");if(s)try{const e=JSON.parse(s);this.addBanner(e,!1,!0)}catch(e){console.warn("Failed to deserialize X-VSS-GlobalMessage header: "+e)}}}),this.handleLegacyGlobalMessage=(e=>{this.addBanner(e.detail,!1,!0)})}_serviceStart(e){super._serviceStart(e);const s=this.pageContext.getService("IVssContributionService"),t=s.getSharedData(i);this.currentMessageBanners=t&&t.banners?t.banners:[];const o=s.getSharedData(a);this.currentDialogs=o&&o.dialogs?o.dialogs:[],n.requestListeners.subscribe(this.handleEndRequest,"afterRequest"),document.body.addEventListener("legacyGlobalMessage",this.handleLegacyGlobalMessage)}_serviceEnd(e){n.requestListeners.unsubscribe(this.handleEndRequest,"afterRequest"),document.body.removeEventListener("legacyGlobalMessage",this.handleLegacyGlobalMessage)}addToast(t){this._notify(t,s[e].GlobalToastChangedEvent)}getDialog(){return this.currentDialogs[0]}addDialog(t,n,a){if(a){const e=this.currentDialogs[0];if(e&&(e.priority||0)>=(t.priority||0))return}n&&this.currentDialogs.shift(),this.currentDialogs.unshift(t),this._notify(t,s[e].GlobalDialogChangedEvent)}closeDialog(){const t=this.getDialog();if(t&&t.settingId){const e={};e[o+t.settingId]=!0,this.pageContext.getRestClient("ISettingsRestClient").setEntries(e,"me")}this.currentDialogs.shift(),this._notify(this.currentDialogs[0],s[e].GlobalDialogChangedEvent)}getBanner(){return this.currentMessageBanners[0]}addBanner(t,n,a){if(a){const e=this.currentMessageBanners[0];if(e&&(e.level||0)>=(t.level||0))return}n&&this.currentMessageBanners.shift(),this.currentMessageBanners.unshift(t),this._notify(t,s[e].GlobalMessageChangedEvent)}getActions(){const e=this.pageContext.getService("IVssContributionService").getSharedData(i);return e&&e.actions?e.actions:void 0}closeBanner(){const t=this.getBanner();if(t&&t.settingId){const e={};e[r+t.settingId]=!0,this.pageContext.getRestClient("ISettingsRestClient").setEntries(e,"me")}this.currentMessageBanners.shift(),this._notify(this.currentMessageBanners[0],s[e].GlobalMessageChangedEvent)}}});t.Services.add("ms.vss-tfs-web.tfs-global-messages-service",{serviceFactory:class extends t.VssService{addBanner(e){this.pageContext.getService("IGlobalMessagesService").addBanner(e)}addToast(e){const s=this.pageContext.getService("IGlobalMessagesService"),t=Object.assign({},e,{onCallToActionClick:()=>{e.onCallToActionClick&&e.onCallToActionClick()}});s.addToast(t)}setGlobalMessageBanner(e){this.addBanner(e)}},options:1})}("GlobalMessagesService"),function(e){h=s.ComponentsGlobalDialog={},Object.defineProperty(s,"__esModule",{value:!0});class t extends i.VssComponent{constructor(e,s){super(e,s),this.onCornerDialogClose=(()=>{this.globalMessageService.closeDialog()}),this.onDialogChanged=(e=>{this.setState({dialog:e})}),this.globalMessageService=s.pageContext.getService("IGlobalMessagesService");const t=this.globalMessageService.getDialog();this.state={dialog:t}}componentDidMount(){this.globalMessageService.subscribe(this.onDialogChanged,d.GlobalDialogChangedEvent)}render(){const{dialog:e}=this.state;if(!e)return null;const s=e.buttonProps||[];return e.closeButtonProps&&s.push(Object.assign({},e.closeButtonProps,{onClick:this.onCornerDialogClose})),e.componentType?a.createElement(i.WrappedComponent,Object.assign({wrappedType:e.componentType,dependencies:e.contentDependencies},Object.assign({onDismiss:this.onCornerDialogClose},e.contentProperties))):a.createElement(i.WrappedComponent,{wrappedType:"cornerDialog",dependencies:["ms.vss-features.ui-layer-content"],onDismiss:this.onCornerDialogClose,footerButtonProps:s.length>0?s:void 0,titleProps:{text:e.title}},e.message||e.messageFormat&&e.messageLinks?e.messageFormat&&e.messageLinks?a.createElement(o.FormatComponent,{className:"message",format:e.messageFormat},e.messageLinks.map((e,s)=>a.createElement(r.Link,{href:e.href,target:"_blank",rel:"noopener noreferrer",key:s},e.name))):a.createElement("div",{className:"message"},e.message):null)}componentWillUnmount(){this.globalMessageService.unsubscribe(this.onDialogChanged,d.GlobalDialogChangedEvent),super.componentWillUnmount()}}t.componentType="globalDialog",s.ComponentsGlobalDialog.GlobalDialogComponent=t,i.VssComponent.register(t.componentType,t)}(),function(e){p=s.ComponentsGlobalMessageBanner={},Object.defineProperty(s,"__esModule",{value:!0});class t extends i.VssComponent{constructor(e,s){super(e,s),this.onKeyDown=(e=>{13!==e.keyCode&&32!==e.keyCode||(this.onMessageBannerClose(),e.preventDefault())}),this.onMessageBannerClose=(()=>{this.globalMessagesService.closeBanner()}),this.onMessageBannerChanged=(e=>{this.setState({messageBanner:e})}),this.globalMessagesService=s.pageContext.getService("IGlobalMessagesService"),this.globalMessagesService.subscribe(this.onMessageBannerChanged,d.GlobalMessageChangedEvent);const t=this.globalMessagesService.getBanner();this.state={messageBanner:t}}render(){const{messageBanner:e}=this.state;if(!e)return null;const{level:s}=e;let t="info-message",n="Info";return 3===s?(t="success-message",n="Completed"):2===s?(t="error-message",n="Error"):1===s&&(t="warning-message",n="Warning"),e.customIcon&&(n=e.customIcon),a.createElement("div",{className:"global-message-banner flex-row flex-grow fontSizeM "+t},c.Icon({className:"level-icon",iconName:n}),e.message||e.messageFormat&&e.messageLinks?e.messageFormat&&e.messageLinks?a.createElement(o.FormatComponent,{className:"message",format:e.messageFormat},e.messageLinks.map((e,s)=>e.supportsFPS?a.createElement(l.FPSLink,{href:e.href},e.name):a.createElement(r.Link,{href:e.href,target:"_blank",rel:"noopener noreferrer",key:s},e.name))):a.createElement("div",{className:"message"},e.message):null,e._links&&e._links.learn?a.createElement(r.Link,{className:"learn-link",href:e._links.learn.href},m.LearnMore):null,e.componentType?a.createElement(i.WrappedComponent,Object.assign({wrappedType:e.componentType,dependencies:e.contentDependencies},Object.assign({onDismiss:this.onMessageBannerClose},e.contentProperties))):null,!1!==e.dismissable?a.createElement(g.Tooltip,{showOnFocus:!0,text:m.Dismiss},a.createElement("span",{"aria-label":m.Dismiss,className:"inline-flex-row dismiss",onClick:this.onMessageBannerClose,onKeyDown:this.onKeyDown,role:"button",tabIndex:0},c.Icon({iconName:"Cancel"}))):null)}componentWillUnmount(){this.globalMessagesService.unsubscribe(this.onMessageBannerChanged,d.GlobalMessageChangedEvent),super.componentWillUnmount()}}t.componentType="globalBanner",s.ComponentsGlobalMessageBanner.GlobalBannerComponent=t,i.VssComponent.register(t.componentType,t);class n extends i.VssComponent{constructor(e,s){if(super(e,s),this.globalMessagesService=s.pageContext.getService("IGlobalMessagesService"),this.layoutManager=s.pageContext.getService("IVssLayoutManager"),this.actions=this.globalMessagesService.getActions(),this.actions&&this.actions.length)for(const e of this.actions)this.layoutManager.renderCallout(s=>a.createElement(i.WrappedComponent,Object.assign({wrappedType:e.componentType,dependencies:e.contentDependencies},Object.assign({onClose:s},e.contentProperties))))}render(){return null}}n.componentType="globalActions",i.VssComponent.register(n.componentType,n)}(),function(e){u=s.ComponentsGlobalToast={},Object.defineProperty(s,"__esModule",{value:!0});class t extends i.VssComponent{constructor(e,s){super(e,s),this.toastRef=a.createRef(),this.toastQueue=[],this.toastExpiresTimeoutId=-1,this.keyId=0,this.onNewToast=(e=>{e.forceOverrideExisting?this.fadeOutAndRenderNew(e):this.state.toast?this.toastQueue.push(e):this.updateCurrentToast(e)}),this.onToastExpires=(()=>{const e=this.toastQueue.shift();e?this.fadeOutAndRenderNew(e):this.clearToast()}),this.globalMessagesService=s.pageContext.getService("IGlobalMessagesService"),this.state={}}render(){const{toast:e}=this.state;return e?a.createElement(i.WrappedComponent,Object.assign({wrappedType:"toast",dependencies:["ms.vss-features.ui-layer-content"],key:"globalToast"+this.keyId,wrappedRef:this.toastRef},e)):null}componentDidMount(){this.globalMessagesService.subscribe(this.onNewToast,d.GlobalToastChangedEvent)}componentWillUnmount(){this.fadeOutPromiseCancelable&&this.fadeOutPromiseCancelable.cancel(),clearTimeout(this.toastExpiresTimeoutId),this.globalMessagesService.unsubscribe(this.onNewToast,d.GlobalToastChangedEvent)}fadeOutAndRenderNew(e){this.toastRef.current?(this.fadeOutPromiseCancelable=this.toastRef.current.fadeOut(),this.fadeOutPromiseCancelable.promise.then(()=>{this.updateCurrentToast(e)})):this.updateCurrentToast(e)}updateCurrentToast(e){this.keyId+=1,clearTimeout(this.toastExpiresTimeoutId),this.setState({toast:e},()=>{this.toastExpiresTimeoutId=setTimeout(this.onToastExpires,e.duration)})}clearToast(){this.toastRef.current&&(this.fadeOutPromiseCancelable&&this.fadeOutPromiseCancelable.cancel(),this.fadeOutPromiseCancelable=this.toastRef.current.fadeOut(),this.fadeOutPromiseCancelable.promise.then(()=>{this.setState({toast:void 0})}))}}t.componentType="globalToast",s.ComponentsGlobalToast.GlobalToastComponent=t,i.VssComponent.register(t.componentType,t)}(),function(e){s.ComponentsGlobalMessages={},Object.defineProperty(s,"__esModule",{value:!0});class t extends i.VssComponent{render(){return a.createElement(a.Fragment,null,a.createElement(p.GlobalBannerComponent,null),a.createElement(h.GlobalDialogComponent,null),a.createElement(u.GlobalToastComponent,null))}}t.componentType="globalMessages",i.VssComponent.register(t.componentType,t)}()},["Resources","GlobalMessagesService","Components/GlobalDialog","Components/GlobalMessageBanner","Components/GlobalToast","Components/GlobalMessages"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.global-banner-content"}}));