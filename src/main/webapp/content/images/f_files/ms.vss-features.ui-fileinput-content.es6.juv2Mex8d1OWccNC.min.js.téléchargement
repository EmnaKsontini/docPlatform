"use strict";define("VSSUI",["require","exports","react","VSS/Core/Util/String"],function(e,t,s,i){var r,n;!function(e){r=t.ComponentsFileInputFileInput={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsFileInputFileInput.FileInput=class extends s.Component{constructor(){super(...arguments),this._files=[],this._clear=(()=>{this._files.forEach(e=>{e.fileReader.readyState!==FileReader.DONE&&e.fileReader.abort()}),this._files=[],this.setState({files:this._files,errorMessage:""}),this._triggerUpdateEvent()}),this._remove=(e=>{this._files=this._files.filter(t=>t!==e),this.setState({files:this._files}),this._triggerUpdateEvent()}),this._addFiles=(e=>{if(this.props.allowedFileExtensions&&this.props.allowedFileExtensions.length>0)for(let s=0;s<e.length;s++){let r=e[s].name.split(".").pop(),n=!1;for(let e=0;e<this.props.allowedFileExtensions.length;e++)if(r.toLocaleLowerCase()===this.props.allowedFileExtensions[e].toLocaleLowerCase()){n=!0;break}if(!n){let e=i.format(t.VSSResourcesVSSUI.FileInputErrorNotAllowedExtensionType,r,this.props.allowedFileExtensions.join());return void this.setState({errorMessage:e})}}let s={};for(let e=0,t=this._files.length;e<t;e++)s[this.props.fileNamesCaseSensitive?this._files[e].result.name:this._files[e].result.name.toLowerCase()]=1;let r=this._getTotalFilesSize();for(let n=0,l=e.length;n<l;n++){if(this.props.maximumSingleFileSize&&e[n].size>this.props.maximumSingleFileSize){let s=this._getLimitErrorMessage(i.format(t.VSSResourcesVSSUI.FileInputErrorMaxFileSize,e[n].name,this._getFriendlySizeString(e[n].size),this._getFriendlySizeString(this.props.maximumSingleFileSize)),{fileSize:e[n].size});return void this.setState({errorMessage:s})}r+=e[n].size;let l=this.props.fileNamesCaseSensitive?e[n].name:e[n].name.toLowerCase();if(s[l]){let s=i.format(t.VSSResourcesVSSUI.FileInputErrorDuplicateFileName,e[n].name);return void this.setState({errorMessage:s})}s[l]=1}if(this.props.maximumTotalFileSize&&r>this.props.maximumTotalFileSize){let e=this._getLimitErrorMessage(i.format(t.VSSResourcesVSSUI.FileInputErrorTotalFileSize,this._getFriendlySizeString(r),this._getFriendlySizeString(this.props.maximumTotalFileSize)),{totalSize:r});return void this.setState({errorMessage:e})}let n=this._files.length+e.length;if(this.props.maximumNumberOfFiles&&n>this.props.maximumNumberOfFiles){let e=1===this.props.maximumNumberOfFiles?t.VSSResourcesVSSUI.FileInputErrorSingleFileOnly:i.format(t.VSSResourcesVSSUI.FileInputErrorMaxNumFiles,this.props.maximumNumberOfFiles),s=this._getLimitErrorMessage(e,{fileCount:n});this.setState({errorMessage:s})}else for(let t=0,s=e.length;t<s;t++)this._addFile(e[t])})}render(){let e=this.props.maximumNumberOfFiles||0,i=this._files,r=this.state&&this.state.errorMessage?this.state.errorMessage:"",l=!e||i.length<e,o=null;this.props.allowedFileExtensions&&(o=this.props.allowedFileExtensions.map(e=>"."!==e[0]?"."+e:e).join());let a=1===e?t.VSSResourcesVSSUI.FileInputDragDropSingleFileLabel:t.VSSResourcesVSSUI.FileInputDragDropLabel,p=1!==e;return s.createElement(n,{dragDropLabel:a,multiple:p,canAddMoreFiles:l,accept:o,files:i,errorMessage:r,addFiles:this._addFiles,remove:this._remove,clear:this._clear})}_addFile(e){let s={name:e.name,size:e.size,type:e.type,lastModifiedDate:e.lastModified?new Date(e.lastModified):e.lastModifiedDate,statusText:t.VSSResourcesVSSUI.Loading,isError:!1},r=new FileReader,n={result:s,fileReader:r};this._files.push(n);let l=()=>{this.setState({files:this._files,errorMessage:this.state&&this.state.errorMessage?this.state.errorMessage:""}),this._triggerUpdateEvent()},o=()=>{s.statusText=this._getFriendlySizeString(e.size),l()};r.onload=(e=>{if(s.encoding=0,1===this.props.resultContentType)s.content=r.result||"";else{let e=r.result;e&&e.indexOf(",")>-1?(s.content=e.substr(e.indexOf(",")+1),"//"===s.content.substr(0,2)&&s.content.length%4==2&&(s.content=s.content.substr(2))):s.content="",this.props.detectEncoding&&(s.encoding=function(e){if(void 0===window.atob)return 0;for(var t=window.atob(e),s=[],i=0;i<4;i++)s.push(t.charCodeAt(i));if(254===s[0]&&255===s[1])return 6;if(255===s[0]&&254===s[1])return 0===s[2]&&0===s[3]?5:7;if(239===s[0]&&187===s[1]&&191===s[2])return 3;if(0===s[0]&&0===s[1]&&254===s[2]&&255===s[3])return 4;for(var r=!0,n=(i=0,t.length);i<n;i++){var l=t.charCodeAt(i);if((l<=31||127==l)&&9!=l&&12!=l&&13!=l&&10!=l&&26!=l)return 1;l>127&&(r=!1)}return r?2:3}(s.content))}o()}),r.onerror=(e=>{i.format(t.VSSResourcesVSSUI.FileInputReadErrorFormat,s.name,r.error.message),s.statusText=t.VSSResourcesVSSUI.FileInputErrorLabel,s.isError=!0,l()}),r.onloadend=(e=>{l()}),1===this.props.resultContentType?r.readAsText(e):2===this.props.resultContentType?(s.encoding=0,s.file=e,o(),l()):r.readAsDataURL(e)}_triggerUpdateEvent(){this.props.updateHandler&&this.props.updateHandler({loading:this._files.some(e=>e.fileReader.readyState!==FileReader.DONE),files:this._files})}_getTotalFilesSize(){let e=0,t=this._files;for(let s=0,i=t.length;s<i;s++)e+=t[s].result.size;return e}_getLimitErrorMessage(e,t){let s=e;return this.props.limitMessageFormatter&&(s=this.props.limitMessageFormatter(e,t)),s}_getFriendlySizeString(e,s=1){return Math.pow(10,s),e<1024?i.format(t.VSSResourcesVSSUI.FileSizeBytesFormat,e):e<1048576?i.format(t.VSSResourcesVSSUI.FileSizeKBFormat,Math.round(e/1024*10)/10):i.format(t.VSSResourcesVSSUI.FileSizeMBFormat,Math.round(e/1048576*10)/10)}};class n extends s.Component{constructor(){super(...arguments),this._onClearClick=(()=>{this.props.clear&&this.props.clear()}),this._onRemoveClick=(e=>{this.props.remove&&this.props.remove(e)}),this._onRemoveKeyDown=((e,t)=>{"Enter"!==e.key&&" "!==e.key&&"Spacebar"!==e.key||this.props.remove&&this.props.remove(t)}),this._onBrowseContainerClick=(()=>{this._fileInput&&this._fileInput.click()}),this._onBrowseContainerKeyPress=(e=>{!this._fileInput||13!==e.which&&32!==e.which||this._fileInput.click()}),this._resolveFileInput=(e=>{this._fileInput=e}),this._resolveRemoveLink=(e=>{this._removeLink||(this._removeLink=e)}),this._onDragEnter=(e=>{this._setDropEffect(e),e.preventDefault(),this.setState({isDragging:!0})}),this._onDragLeave=(e=>{e.preventDefault(),this.setState({isDragging:!1})}),this._onDragOver=(e=>{this._setDropEffect(e),e.preventDefault(),this.setState({isDragging:!0})}),this._onDrop=(e=>{this._setDropEffect(e),e.preventDefault(),this.setState({isDragging:!1});let t=e.dataTransfer.files;t&&t.length>0&&this.props.addFiles&&this.props.addFiles(t)}),this._onFileInputChange=(e=>{this._removeLink=void 0,e.currentTarget.files&&e.currentTarget.files.length&&(this.props.addFiles&&this.props.addFiles(e.currentTarget.files),e.currentTarget.value="")})}render(){let e=t.Util.css("vss-FileInput-filesDropTarget",this.state.isDragging?this.props.dragOverCssClass||"vss-FileInput-dragOver":"");return s.createElement("div",{className:"vss-FileInput"},this.props.canAddMoreFiles&&s.createElement("div",{className:e,onDragOver:this._onDragOver,onDragLeave:this._onDragLeave,onDragEnter:this._onDragEnter,onDrop:this._onDrop},s.createElement("div",{className:"vss-FileInput-dragDropTable",role:"presentation"},s.createElement("div",{className:"vss-FileInput-dragDropLabel"},s.createElement("span",null,this.props.dragDropLabel)),s.createElement("div",{className:"vss-FileInput-browseButton"},s.createElement("button",{className:"vss-FileInput-browseContainer",onKeyPress:this._onBrowseContainerKeyPress,onClick:this._onBrowseContainerClick},t.VSSResourcesVSSUI.FileInputBrowseButtonLabel),s.createElement("input",{type:"file",ref:this._resolveFileInput,onChange:this._onFileInputChange,accept:this.props.accept,multiple:this.props.multiple,style:{display:"none"}})))),this.props.files.length>1&&s.createElement("div",{className:"vss-FileInput-overallStatusContainer"},s.createElement("span",{className:"vss-FileInput-overallStatusActions"},s.createElement("a",{onClick:this._onClearClick},t.VSSResourcesVSSUI.FileInputRemoveAll))),s.createElement("div",{className:"vss-FileInput-errorContainer"},this.props.errorMessage),this.props.files.length>0&&s.createElement("ul",{className:"vss-FileInput-fileList",style:{display:"block"}},this.props.files.map(e=>s.createElement("li",{key:e.result.name},s.createElement("div",{className:"vss-FileInput-headerContainer"},s.createElement("span",{className:"vss-FileInput-fileName"},e.result.name)),s.createElement("div",{className:"vss-FileInput-detailsContainer"},s.createElement("span",{className:"vss-FileInput-status"},e.result.statusText),s.createElement("span",{className:"vss-FileInput-links"},s.createElement("a",{tabIndex:0,ref:this._resolveRemoveLink,onKeyDown:t=>this._onRemoveKeyDown(t,e),onClick:()=>this._onRemoveClick(e),role:"button"},t.VSSResourcesVSSUI.FileInputRemoveFile)))))))}componentWillMount(){this.setState({isDragging:!1})}componentDidUpdate(){this._removeLink&&this._removeLink.focus()}_setDropEffect(e){try{e.dataTransfer.dropEffect="copy"}catch(e){}}}}(),function(e){n=t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),function(s){for(var i in s)t[e].hasOwnProperty(i)||(t[e][i]=s[i])}(r)}("ComponentsFileInputindex"),function(e){t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),function(s){for(var i in s)t[e].hasOwnProperty(i)||(t[e][i]=s[i])}(n)}("FileInput")},["Components/FileInput/FileInput","Components/FileInput/index","FileInput"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.ui-fileinput-content"}}));